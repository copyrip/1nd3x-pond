<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Shared Cursors</title>
  <style>
    body { margin:0; height:100vh; overflow:hidden; cursor:none; background:#fafafa; }
    .cursor {
      position:absolute;
      pointer-events:none;
      transform:translate(-50%, -50%);
      text-align:center;
      font-family:sans-serif;
    }
    .username {
      font-size:12px;
      color:#333;
      margin-top:-15px;
    }
    .controls {
      position:fixed;
      top:10px; left:10px;
      background:white;
      padding:10px;
      border:1px solid #ccc;
      border-radius:5px;
    }
    .controls input, .controls select { margin:5px; }
  </style>
</head>
<body>
  <div class="controls">
    Username: <input id="username" placeholder="Enter name">
    Cursor Color: <input type="color" id="color" value="#ff0000">
    Hat: 
    <select id="hat">
      <option value="">None</option>
      <option value="https://media.giphy.com/media/3oEjI6SIIHBdRxXI40/giphy.gif">Party</option>
      <option value="https://media.giphy.com/media/26BRzozg4TCBXv6QU/giphy.gif">Top Hat</option>
    </select>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    const cursors = {};

    let username = '';
    let color = '#ff0000';
    let hat = '';

    const cursorEl = document.createElement('div');
    cursorEl.classList.add('cursor');
    cursorEl.innerHTML = '<div id="hat-img"></div><div class="username" id="user-label"></div>';
    document.body.appendChild(cursorEl);

    const hatImg = document.getElementById('hat-img');
    const userLabel = document.getElementById('user-label');

    document.getElementById('username').addEventListener('input', e => username = e.target.value);
    document.getElementById('color').addEventListener('input', e => color = e.target.value);
    document.getElementById('hat').addEventListener('change', e => {
      hat = e.target.value;
      hatImg.innerHTML = hat ? `<img src="${hat}" width="32" height="32">` : '';
    });

    document.addEventListener('mousemove', e => {
      cursorEl.style.left = e.clientX + 'px';
      cursorEl.style.top = e.clientY + 'px';
      userLabel.textContent = username;
      userLabel.style.color = color;

      socket.emit('cursor-move', { x: e.clientX, y: e.clientY, username, color, hat });
    });

    socket.on('cursors-update', data => {
      for (let id in data) {
        if (id === socket.id) continue;

        if (!cursors[id]) {
          const el = document.createElement('div');
          el.classList.add('cursor');
          el.innerHTML = '<div class="hat"></div><div class="username"></div>';
          document.body.appendChild(el);
          cursors[id] = el;
        }

        const c = cursors[id];
        c.style.left = data[id].x + 'px';
        c.style.top = data[id].y + 'px';
        c.querySelector('.username').textContent = data[id].username;
        c.querySelector('.username').style.color = data[id].color;
        c.querySelector('.hat').innerHTML = data[id].hat ? `<img src="${data[id].hat}" width="32" height="32">` : '';
      }

      // Remove disconnected users
      for (let id in cursors) {
        if (!data[id]) {
          cursors[id].remove();
          delete cursors[id];
        }
      }
    });
  </script>
</body>
</html>